<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-pages/concepts/tracing_resolution">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Tracing package resolution | Lockfile Explorer</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lfx.rushstack.io/images/site/lfx-ograph.jpg"><meta data-rh="true" name="twitter:image" content="https://lfx.rushstack.io/images/site/lfx-ograph.jpg"><meta data-rh="true" property="og:url" content="https://lfx.rushstack.io/pages/concepts/tracing_resolution/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Tracing package resolution | Lockfile Explorer"><meta data-rh="true" name="description" content="CommonJS module resolution"><meta data-rh="true" property="og:description" content="CommonJS module resolution"><link data-rh="true" rel="icon" href="/images/site/favicon.ico"><link data-rh="true" rel="canonical" href="https://lfx.rushstack.io/pages/concepts/tracing_resolution/"><link data-rh="true" rel="alternate" href="https://lfx.rushstack.io/pages/concepts/tracing_resolution/" hreflang="en"><link data-rh="true" rel="alternate" href="https://lfx.rushstack.io/pages/concepts/tracing_resolution/" hreflang="x-default"><link rel="search" type="application/opensearchdescription+xml" title="Lockfile Explorer" href="/opensearch.xml">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic"><link rel="stylesheet" href="/assets/css/styles.36801861.css">
<link rel="preload" href="/assets/js/runtime~main.e45596cc.js" as="script">
<link rel="preload" href="/assets/js/main.d70b02e8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div class="suiteNavBar_rHPh"><div role="button" class="waffle_FRnN waffleInteraction_uHqh"><img src="/images/suitenav/rs-waffle.svg"></div><div class="waffleDivider_XicE"></div><a href="https://rushstack.io/" class="suiteNavItem_tL2w">Rush Stack</a><a href="https://rushstack.io/pages/shop/" class="suiteNavItem_tL2w">Shop</a><a href="https://rushstack.io/blog/" class="suiteNavItem_tL2w">Blog</a><a href="https://rushstack.io/community/events/" class="suiteNavItem_tL2w">Events</a></div><div role="region" aria-label="Skip to main content"><a class="skipToContent_gOKz" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/site/lockfile-explorer.svg" alt="Lockfile Explorer" class="themedImage_gHi_ themedImage--light_qRI9"><img src="/images/site/lockfile-explorer.svg" alt="Lockfile Explorer" class="themedImage_gHi_ themedImage--dark_a9Fb"></div><b class="navbar__title text--truncate"></b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_p0dq"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/pages/concepts/tracing_resolution/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/pages/basics/getting_started/">Docs</a><a class="navbar__item navbar__link" href="/pages/support/news/">News</a><a class="navbar__item navbar__link" href="/pages/support/contributing/">GitHub</a><a class="navbar__item navbar__link" href="/pages/support/help/">Help</a><div class="searchBox_nqXy"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper__S2k docsWrapper_qYUW"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_TWh7" type="button"></button><div class="docPage_AvjP"><aside class="theme-doc-sidebar-container docSidebarContainer_Q5zy"><div class="sidebarViewport_EUbl"><div class="sidebar_UuKZ"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_ryys"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Introduction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/basics/getting_started/">Getting started</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">Versioning Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/concepts/version_conflicts/">Version conflicts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/concepts/semver/">SemVer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/concepts/install_models/">Installation models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/pages/concepts/tracing_resolution/">Tracing package resolution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/concepts/pnpm_lockfile/">The PNPM lockfile</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/concepts/strict_settings/">Strict settings</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Scenarios</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/scenarios/demos_repo/">Demos repository</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/scenarios/side-by-side_versions/">Side-by-side versions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/scenarios/peer_dependencies/">Peer dependencies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/scenarios/npm_doppelgangers/">NPM doppelgangers</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Support</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/support/help/">Help</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/support/news/">What&#x27;s new</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/support/contributing/">Contributing</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_xjo8"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_h54n"><div class="docItemContainer_ZJUz"><article><div class="tocCollapsible_bs80 theme-doc-toc-mobile tocMobile_ZG1n"><button type="button" class="clean-btn tocCollapsibleButton_SJYF">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Tracing package resolution</h1></header><h2 class="anchor anchorWithStickyNavbar_g9Wv" id="commonjs-module-resolution">CommonJS module resolution<a href="#commonjs-module-resolution" class="hash-link" aria-label="Direct link to CommonJS module resolution" title="Direct link to CommonJS module resolution">​</a></h2><p>If you are using the NPM or PNPM <a href="/pages/concepts/install_models/">installation model</a>, the CommonJS <code>require()</code> API performs
module resolution by traversing physical folders on disk. This is convenient for troubleshooting, as many
problems can be understood simply by inspecting folders using your shell. The complete algorithm is detailed in
<a href="https://nodejs.org/api/modules.html#all-together" target="_blank" rel="noopener noreferrer">the Node.js specification</a>, but here&#x27;s a quick summary
(ignoring many details such as folder imports and path mappings):</p><ol><li><p>If your import path starts with <code>.</code> or <code>..</code> or <code>/</code>, for example <code>require(&#x27;./path/to/file&#x27;)</code>,
then the entire string will be resolved as a regular file/folder path.</p></li><li><p>Otherwise, the first part will be interpreted as an NPM package name. For example
<code>require(&#x27;one/two/three&#x27;)</code> would look for an NPM package called <code>one</code>,
and <code>require(&#x27;@company/one/two/three&#x27;)</code> would look for an NPM package <code>@company/one</code>.</p></li><li><p>If the API call <code>require(&#x27;@company/one/two/three&#x27;)</code> is performed by a script <code>/a/b/c/d/e.js</code>, then
the module resolver will look for the <code>@company/one</code> install folder by searching for <code>node_modules</code> folders
in parents of the script&#x27;s folder. In our example, the following paths would be checked (approximately, ignoring many details):</p><ul><li><code>/a/b/c/d/node_modules/@company/one/package.json</code></li><li><code>/a/b/c/node_modules/@company/one/package.json</code></li><li><code>/a/b/node_modules/@company/one/package.json</code></li><li><code>/a/node_modules/@company/one/package.json</code></li><li><code>/node_modules/@company/one/package.json</code></li></ul><p>The first match is taken, ignoring other possible matches. If no match is found, then <code>require()</code> fails
by throwing an exception.</p></li><li><p>Once a match is found, the <code>two/three</code> module subpath is evaluated relative to the <code>@company/one</code> install folder.
Let&#x27;s suppose that <code>/a/b/node_modules/@company/one/package.json</code> was the found install folder;
then (absent other mappings) the resolved target path will be <code>/a/b/node_modules/@company/one/two/three.js</code>.</p></li><li><p>If the package subpath is not specified, for example <code>require(&#x27;@company/one&#x27;)</code>, then a main index will be used.
The default would be <code>/a/b/node_modules/@company/one/index.js</code>, but most likely an explicit path will be
specified by a <strong>package.json</strong> field such as <code>&quot;main&quot;</code>. For example, with <code>&quot;main&quot;: &quot;dist/bundle.js&quot;</code>,
the final target path instead would become <code>/a/b/node_modules/@company/one/dist/bundle.js</code>.</p></li></ol><p>A couple important things to understand about this algorithm:</p><ul><li><p><strong>Phantom dependencies are possible:</strong>
Your <code>node_modules</code> folder was probably created by <code>pnpm install</code> based on some <strong>package.json</strong> file,
most likely the package that owns our example script <code>/a/b/c/d/e.js</code>. However, at no point does the algorithm
read THAT <strong>package.json</strong> file. Resolution only considers <code>node_modules</code> folders, regardless of how they
were created. This is the fundamental design flaw that makes
<a href="https://rushjs.io/pages/advanced/phantom_deps/" target="_blank" rel="noopener noreferrer">phantom dependencies</a> possible, along with <strong>&quot;hoisting&quot;</strong>
which is the dubious practice of intentionally introducing phantom dependencies.</p></li><li><p><strong>Symlinks get normalized:</strong> When a package is resolved via a symlink, the folder path is normalized
by calling <a href="https://nodejs.org/api/fs.html#fspromisesrealpathpath-options" target="_blank" rel="noopener noreferrer">fs.realpath()</a>
to eliminate any symlinks, so that Step 3 will visit parent folders from the physical path
instead of the logical (with symlinks) path.</p><p>For example: suppose that <code>/my-repo/my-app/node_modules/my-library</code> is actually a symlink to
<code>/my-repo/my-library</code>, and the executing script was imported as <code>./node_modules/my-library/dist/bundle.js</code>.
When <code>bundle.js</code> calls <code>require(&#x27;some-other-library&#x27;)</code>, the searched parent folder will be
<code>/my-repo/my-library/node_modules/</code>, NOT <code>/my-repo/my-app/node_modules</code>. This feature is what enables
the PNPM installation model to eliminate phantom dependencies.</p><p>(This was not true in ancient versions of Node.js; see the
<a href="https://nodejs.org/api/all.html#cli_preserve_symlinks" target="_blank" rel="noopener noreferrer">--preserve-symlinks</a> docs for details.)</p></li></ul><h3 class="anchor anchorWithStickyNavbar_g9Wv" id="-tracing-commonjs-resolution">🔍 Tracing CommonJS resolution<a href="#-tracing-commonjs-resolution" class="hash-link" aria-label="Direct link to 🔍 Tracing CommonJS resolution" title="Direct link to 🔍 Tracing CommonJS resolution">​</a></h3><p>Let&#x27;s try a hands-on experiment, to see how CommonJS resolution can be traced by inspecting folders on disk.</p><h4 class="anchor anchorWithStickyNavbar_g9Wv" id="1-clone-the-demo-repo">1. Clone the demo repo<a href="#1-clone-the-demo-repo" class="hash-link" aria-label="Direct link to 1. Clone the demo repo" title="Direct link to 1. Clone the demo repo">​</a></h4><p>Clone and install the <a href="https://github.com/microsoft/lockfile-explorer-demos/tree/demo/sample-1" target="_blank" rel="noopener noreferrer">demo/sample-1</a>
branch from the <a href="https://github.com/microsoft/lockfile-explorer-demos/" target="_blank" rel="noopener noreferrer">lockfile-explorer-demos</a>
demo repo. <strong><em>You will need to launch the Verdaccio service in a separate shell window.</em></strong> See the
<a href="/pages/scenarios/demos_repo/">Demos repository</a> topic for instructions.</p><p>Recall that the <code>demo/sample-1</code> lockfile looks like this:</p><img loading="lazy" src="https://raw.githubusercontent.com/microsoft/lockfile-explorer-demos/demo/sample-1/common/images/lfx-demo-sample-1.svg" alt="dependency graph: demo/sample-1" class="img_NCFY"><h4 class="anchor anchorWithStickyNavbar_g9Wv" id="2-inspect-the-symlinks">2. Inspect the symlinks<a href="#2-inspect-the-symlinks" class="hash-link" aria-label="Direct link to 2. Inspect the symlinks" title="Direct link to 2. Inspect the symlinks">​</a></h4><p>After running <code>rush install</code> in the <code>~/lockfile-explorer-demos/</code> folder, the project <code>C</code> should
have the following files:</p><ul><li><code>~/lockfile-explorer-demos/projects/c/package.json</code>: defines the package</li><li><code>~/lockfile-explorer-demos/projects/c/index.js</code>: some placeholder source code</li><li><code>~/lockfile-explorer-demos/projects/c/node_modules/@rushstack/e/</code>: installed folder for dependency E</li><li><code>~/lockfile-explorer-demos/projects/c/node_modules/@rushstack/k/</code>: installed folder for dependency K</li><li><code>~/lockfile-explorer-demos/projects/c/node_modules/@rushstack/m/</code>: installed folder for dependency M</li></ul><p>Observe that PNPM has created symlinks in the <code>c/node_modules</code> folder. We can inspect them using the shell:</p><div class="tabs-container tabList_UTb5"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_JDHA tabs__item--active">Bash</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_JDHA">PowerShell</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_JDHA">DOS</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_bzwk"><div class="language-bash codeBlockContainer_WFsW theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_hAFA"><pre tabindex="0" class="prism-code language-bash codeBlock_yyya thin-scrollbar"><code class="codeBlockLines_ncLe"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Example project C&#x27;s node_modules folder</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">ls</span><span class="token plain"> -l projects/c/node_modules/@rushstack/</span><br></span></code></pre><div class="buttonGroup_Id5t"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_iJDH" aria-hidden="true"><svg class="copyButtonIcon__zQr" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bVb9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Output:</p><div class="codeBlockContainer_WFsW theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_hAFA"><pre tabindex="0" class="prism-code language-text codeBlock_yyya thin-scrollbar"><code class="codeBlockLines_ncLe"><span class="token-line" style="color:#000000"><span class="token plain">lrwxrwxrwx 1 e -&gt; /home/yourself/lockfile-explorer-demos/projects/e/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">lrwxrwxrwx 1 k -&gt; /home/yourself/lockfile-explorer-demos/common/temp/node_modules/.pnpm/@rushstack+k@1.0.0_@rushstack+m@1.0.0/node_modules/@rushstack/k/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">lrwxrwxrwx 1 m -&gt; /home/yourself/lockfile-explorer-demos/common/temp/node_modules/.pnpm/@rushstack+m@1.0.0/node_modules/@rushstack/m/</span><br></span></code></pre><div class="buttonGroup_Id5t"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_iJDH" aria-hidden="true"><svg class="copyButtonIcon__zQr" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bVb9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_bzwk" hidden=""><div class="language-powershell codeBlockContainer_WFsW theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_hAFA"><pre tabindex="0" class="prism-code language-powershell codeBlock_yyya thin-scrollbar"><code class="codeBlockLines_ncLe"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Example project C&#x27;s node_modules folder</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">dir</span><span class="token plain"> projects\c\node_modules\@rushstack\ </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">select</span><span class="token plain"> Name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">LinkType</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">Target</span><br></span></code></pre><div class="buttonGroup_Id5t"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_iJDH" aria-hidden="true"><svg class="copyButtonIcon__zQr" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bVb9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Output:</p><div class="codeBlockContainer_WFsW theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_hAFA"><pre tabindex="0" class="prism-code language-text codeBlock_yyya thin-scrollbar"><code class="codeBlockLines_ncLe"><span class="token-line" style="color:#000000"><span class="token plain">Name LinkType Target</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">---- -------- ------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">e    Junction {C:\Git\lockfile-explorer-demos\projects\e\}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k    Junction {C:\Git\lockfile-explorer-demos\common\temp\node_modules\.pnpm\@rushstack+k@1.0.0_@rushstack+m@1.0.0\node_modules\@rushstack\k\}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">m    Junction {C:\Git\lockfile-explorer-demos\common\temp\node_modules\.pnpm\@rushstack+m@1.0.0\node_modules\@rushstack\m\}</span><br></span></code></pre><div class="buttonGroup_Id5t"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_iJDH" aria-hidden="true"><svg class="copyButtonIcon__zQr" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bVb9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_bzwk" hidden=""><div class="language-batch codeBlockContainer_WFsW theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_hAFA"><pre tabindex="0" class="prism-code language-batch codeBlock_yyya thin-scrollbar"><code class="codeBlockLines_ncLe"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">:: Example project C&#x27;s node_modules folder</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token command keyword" style="color:rgb(0, 0, 255)">dir</span><span class="token command"> projects\c\node_modules\@rushstack\</span><br></span></code></pre><div class="buttonGroup_Id5t"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_iJDH" aria-hidden="true"><svg class="copyButtonIcon__zQr" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bVb9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Output:</p><div class="codeBlockContainer_WFsW theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_hAFA"><pre tabindex="0" class="prism-code language-text codeBlock_yyya thin-scrollbar"><code class="codeBlockLines_ncLe"><span class="token-line" style="color:#000000"><span class="token plain">Directory of C:\Git\lockfile-explorer-demos\projects\c\node_modules\@rushstack</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&lt;DIR&gt;          .</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&lt;DIR&gt;          ..</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&lt;JUNCTION&gt;     e [C:\Git\lockfile-explorer-demos\projects\e]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&lt;JUNCTION&gt;     k [C:\Git\lockfile-explorer-demos\common\temp\node_modules\.pnpm\@rushstack+k@1.0.0_@rushstack+m@1.0.0\node_modules\@rushstack\k]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">&lt;JUNCTION&gt;     m [C:\Git\lockfile-explorer-demos\common\temp\node_modules\.pnpm\@rushstack+m@1.0.0\node_modules\@rushstack\m]</span><br></span></code></pre><div class="buttonGroup_Id5t"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_iJDH" aria-hidden="true"><svg class="copyButtonIcon__zQr" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bVb9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p>Observe that:</p><ul><li><code>node_modules/@rushstack/e</code> gets symlinked to <code>projects/e</code> because <code>c/package.json</code> declared
it as a local workspace dependency (<code>&quot;@rushstack/e&quot;: &quot;workspace:*&quot;</code>)</li><li><code>node_modules/@rushstack/m</code> gets symlinked to a folder under <code>common/temp</code> because
<code>c/package.json</code> declared it as an external dependency, installed from the NPM registry
(<code>&quot;@rushstack/m&quot;: &quot;~1.0.0&quot;</code> without <code>workspace:</code>)</li></ul><blockquote><p>Note: In a Rush monorepo, the <code>workspace:</code> dependency specifier unambiguously determines whether
the target is a local project or an external package. This is because Rush silently forces
<a href="https://pnpm.io/npmrc#link-workspace-packages" target="_blank" rel="noopener noreferrer">--link-workspace-packages=false</a>.
If you are using PNPM without Rush, this may not be the case, in which case you&#x27;ll have to
deduce the answer by hunting for a matching workspace project and then double-checking
that its version matches the specified <code>worksapce:</code> range.</p></blockquote><h4 class="anchor anchorWithStickyNavbar_g9Wv" id="3-resolving-with-trace-import">3. Resolving with &quot;trace-import&quot;<a href="#3-resolving-with-trace-import" class="hash-link" aria-label="Direct link to 3. Resolving with &quot;trace-import&quot;" title="Direct link to 3. Resolving with &quot;trace-import&quot;">​</a></h4><p>Instead of inspecting symlinks, we can use the
<a href="https://www.npmjs.com/package/@rushstack/trace-import" target="_blank" rel="noopener noreferrer">@rushstack/trace-import</a>
tool to test how the dependency gets resolved:</p><div class="language-bash codeBlockContainer_WFsW theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_hAFA"><pre tabindex="0" class="prism-code language-bash codeBlock_yyya thin-scrollbar"><code class="codeBlockLines_ncLe"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># From the folder of project C...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">cd</span><span class="token plain"> ~/lockfile-explorer-demos/projects/c/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># ...let&#x27;s try to resolve package M</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">trace-import -p @rushstack/m</span><br></span></code></pre><div class="buttonGroup_Id5t"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_iJDH" aria-hidden="true"><svg class="copyButtonIcon__zQr" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bVb9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Output:</p><div class="codeBlockContainer_WFsW theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_hAFA"><pre tabindex="0" class="prism-code language-text codeBlock_yyya thin-scrollbar"><code class="codeBlockLines_ncLe"><span class="token-line" style="color:#000000"><span class="token plain">trace-import 0.1.0 - https://rushstack.io</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Base folder:             C:\Git\lockfile-explorer-demos\projects\c</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Package name:            @rushstack/m</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Package subpath:         (not specified)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Resolving...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Package folder:          C:\Git\lockfile-explorer-demos\common\temp\node_modules\.pnpm\@rushstack+m@1.0.0\node_modules\@rushstack\m</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">package.json:            @rushstack/m (1.0.0)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Main index:              (none)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Target path:             C:\Git\lockfile-explorer-demos\common\temp\node_modules\.pnpm\@rushstack+m@1.0.0\node_modules\@rushstack\m\index.js</span><br></span></code></pre><div class="buttonGroup_Id5t"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_iJDH" aria-hidden="true"><svg class="copyButtonIcon__zQr" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bVb9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_g9Wv" id="4-tracing-parent-folders">4. Tracing parent folders<a href="#4-tracing-parent-folders" class="hash-link" aria-label="Direct link to 4. Tracing parent folders" title="Direct link to 4. Tracing parent folders">​</a></h4><p>Now let&#x27;s follow the chain a step further. At runtime, suppose that <code>C</code> imports a script from <code>E</code>,
and then <code>E</code> in turn tries to import <code>M</code>. Will it work? We might try this experiment:</p><div class="language-bash codeBlockContainer_WFsW theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_hAFA"><pre tabindex="0" class="prism-code language-bash codeBlock_yyya thin-scrollbar"><code class="codeBlockLines_ncLe"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># From the folder of project C/E...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">cd</span><span class="token plain"> ~/lockfile-explorer-demos/projects/c/node_modules/@rushstack/e/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># ...let&#x27;s try to resolve package M</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">trace-import -p @rushstack/m</span><br></span></code></pre><div class="buttonGroup_Id5t"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_iJDH" aria-hidden="true"><svg class="copyButtonIcon__zQr" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bVb9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Output:</p><div class="codeBlockContainer_WFsW theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_hAFA"><pre tabindex="0" class="prism-code language-text codeBlock_yyya thin-scrollbar"><code class="codeBlockLines_ncLe"><span class="token-line" style="color:#000000"><span class="token plain">trace-import 0.1.0 - https://rushstack.io</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Base folder:             C:\Git\lockfile-explorer-demos\projects\c\node_modules\@rushstack\e</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Package name:            @rushstack/m</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Package subpath:         (not specified)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Resolving...</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ERROR: Cannot find package &quot;@rushstack/m&quot; from &quot;C:\Git\lockfile-explorer-demos\projects\c\node_modules\@rushstack\e&quot;.</span><br></span></code></pre><div class="buttonGroup_Id5t"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_iJDH" aria-hidden="true"><svg class="copyButtonIcon__zQr" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bVb9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Even though <code>projects/c/node_modules/</code> contains M and appears to be a parent folder
of <code>projects/c/node_modules/@rushstack/e/</code>, this path traverses a symlink. Recall that
the <code>require()</code> algorithm uses <code>fs.realpath()</code> to eliminate symlinks, so the search
actually starts from <code>projects/e</code> not <code>projects/c/node_modules/@rushstack/e/</code>.</p><blockquote><p>Warning: If you&#x27;re creating a tool that needs to resolve imports, do not write your own code that
traverses <code>node_modules</code> folders. The presentation here is greatly simplified for learning purposes;
the full algorithm is complex and difficult to implement correctly. Instead, use a standard API such as
<a href="https://nodejs.org/api/modules.html#requireresolverequest-options" target="_blank" rel="noopener noreferrer">require.resolve()</a>,
<a href="https://api.rushstack.io/pages/node-core-library.import/" target="_blank" rel="noopener noreferrer">node-core-library Import</a>,
or the <a href="https://www.npmjs.com/package/resolve" target="_blank" rel="noopener noreferrer">resolve</a> NPM package.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_g9Wv" id="es-module-resolution">ES module resolution<a href="#es-module-resolution" class="hash-link" aria-label="Direct link to ES module resolution" title="Direct link to ES module resolution">​</a></h2><p>CommonJS is considered a &quot;legacy&quot; module system, and today it is mainly used by Node.js
and associated tools such as Jest. Bundlers such as Webpack implement the modern ECMAScript
module system, whose most visible difference is that scripts use <code>import</code> instead of <code>require()</code>.
(Webpack prefers ECMAScript because <code>import</code> is a declaration instead of an API call,
data instead of code, which provides guarantees that enable better optimizations.)</p><p>A library will often want to support both <code>import</code> and <code>require()</code>, which requires maintaining
separate copies of the code in each format. For example, consider the
<a href="https://www.npmjs.com/package/@microsoft/tsdoc" target="_blank" rel="noopener noreferrer">@microsoft/tsdoc</a> NPM package.
Its <strong>package.json</strong> specifies two fields <code>&quot;main&quot;</code> and <code>&quot;module&quot;</code>:</p><p><a href="https://github.com/microsoft/tsdoc/blob/c758984fb4e088e69d7ea34ccab07e9def01448d/tsdoc/package.json#L20" target="_blank" rel="noopener noreferrer">@microsoft/tsdoc/package.json</a></p><div class="language-js codeBlockContainer_WFsW theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_hAFA"><pre tabindex="0" class="prism-code language-js codeBlock_yyya thin-scrollbar"><code class="codeBlockLines_ncLe"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string-property property">&quot;name&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;@microsoft/tsdoc&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string-property property">&quot;version&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;0.14.2&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string-property property">&quot;description&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;A parser for the TypeScript doc comment syntax&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string-property property">&quot;main&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;lib-commonjs/index.js&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string-property property">&quot;module&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;lib/index.js&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string-property property">&quot;typings&quot;</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;lib/index.d.ts&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><br></span></code></pre><div class="buttonGroup_Id5t"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_iJDH" aria-hidden="true"><svg class="copyButtonIcon__zQr" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bVb9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If present, the <code>&quot;module&quot;</code> field will be used by ECMAScript imports. In the above example,
the <code>lib/index.js</code> script will have the <code>import</code> declarations that Webpack understands,
whereas <code>lib-commonjs/index.js</code> would have <code>require()</code> API calls that classic Node.js needs.</p><h2 class="anchor anchorWithStickyNavbar_g9Wv" id="typescript-module-resolution">TypeScript module resolution<a href="#typescript-module-resolution" class="hash-link" aria-label="Direct link to TypeScript module resolution" title="Direct link to TypeScript module resolution">​</a></h2><p>At compile time, TypeScript compiler looks for <code>.d.ts</code> files instead of <code>.js</code> files. In the simple case,
it simply performs CommonJS or ECMAScript resolution to find the <code>.js</code> file, and then looks for a <code>.d.ts</code> file
in the same folder. For example, <code>example-package/dist/bundle.js</code> maps to <code>example-package/dist/bundle.d.ts</code>.</p><p>However, like with <code>&quot;main&quot;</code> and <code>&quot;module&quot;</code>, you can specify a main index using <code>&quot;typings&quot;</code> as seen above.
(The field can be called <code>&quot;types&quot;</code> or <code>&quot;typings&quot;</code> -- they have the same meaning.)</p><p>If none of these methods work, the TypeScript compiler will also search for a
<a href="https://github.com/DefinitelyTyped/DefinitelyTyped" target="_blank" rel="noopener noreferrer">Definitely Typed</a> helper package. The default naming
pattern uses <code>@types</code> NPM scope, like this:</p><table><thead><tr><th>NPM package name</th><th>DefinitelyTyped package name</th></tr></thead><tbody><tr><td><code>example</code></td><td><code>@types/example</code></td></tr><tr><td><code>@scope/example</code></td><td><code>@types/scope__example</code></td></tr></tbody></table><p>The full spec is detailed in the
<a href="https://www.typescriptlang.org/docs/handbook/module-resolution.html" target="_blank" rel="noopener noreferrer">TypeScript Handbook</a>.</p><h3 class="anchor anchorWithStickyNavbar_g9Wv" id="-tracing-typescript-resolution">🔍 Tracing TypeScript resolution<a href="#-tracing-typescript-resolution" class="hash-link" aria-label="Direct link to 🔍 Tracing TypeScript resolution" title="Direct link to 🔍 Tracing TypeScript resolution">​</a></h3><p>The <code>trace-import</code> tool can also be used to try resolving <code>.d.ts</code> files for TypeScript.
The command line is the same as in the above example, except that you need to include
the <code>--resolution-type ts</code> parameter (<code>-t ts</code> for short).</p><p>The <code>trace-import</code> tool is quick and convenient; however, it currently does not implement advanced
import mappings and <strong>tsconfig.json</strong> settings. For the most accurate diagnostics, it&#x27;s recommended
instead to compile your project using the
<a href="https://www.typescriptlang.org/tsconfig/#traceResolution" target="_blank" rel="noopener noreferrer">--traceResolution</a>
switch for <code>tsc</code>. This option produces megabytes of diagnostic logging, so it&#x27;s recommended to
redirect the output to a file, like this:</p><div class="codeBlockContainer_WFsW theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_hAFA"><pre tabindex="0" class="prism-code language-text codeBlock_yyya thin-scrollbar"><code class="codeBlockLines_ncLe"><span class="token-line" style="color:#000000"><span class="token plain">cd my-typescript-project/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># Redirect the output to trace.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tsc --traceResolution &gt; trace.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># Now you can inspect this file using VS Code</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">code trace.log</span><br></span></code></pre><div class="buttonGroup_Id5t"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_iJDH" aria-hidden="true"><svg class="copyButtonIcon__zQr" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bVb9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_g9Wv" id="see-also">See also<a href="#see-also" class="hash-link" aria-label="Direct link to See also" title="Direct link to See also">​</a></h2><ul><li><a href="https://www.npmjs.com/package/@rushstack/trace-import" target="_blank" rel="noopener noreferrer">@<!-- -->rushstack/trace-import</a>: Our command-line tool for troubleshooting how modules are resolved by <code>import</code> and <code>require()</code></li><li><a href="https://nodejs.org/api/modules.html#all-together" target="_blank" rel="noopener noreferrer">Node.js require()</a> specification and algorithm</li><li><a href="https://nodejs.org/api/modules.html#requireresolverequest-options" target="_blank" rel="noopener noreferrer">Node.js require.resolve()</a> API docs</li><li><a href="https://api.rushstack.io/pages/node-core-library.import/" target="_blank" rel="noopener noreferrer">node-core-library Import</a>: the Rush Stack API
which provides similar functionality as <code>require.resolve()</code> but with improved TypeScript typings and some
additional features</li><li><a href="https://www.npmjs.com/package/resolve" target="_blank" rel="noopener noreferrer">resolve</a>: a standalone NPM package that implements
<code>require.resolve()</code> algorithm with the ability to specify a base folder (it is used internally
by <code>Import</code>)</li><li><a href="https://docs.npmjs.com/cli/v6/configuring-npm/package-json" target="_blank" rel="noopener noreferrer">package.json fields</a> docs from NPM</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/microsoft/rushstack-websites/tree/main/websites/lfx.rushstack.io/docs/pages/concepts/tracing_resolution.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Svw6" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_movT"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/pages/concepts/install_models/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Installation models</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/pages/concepts/pnpm_lockfile/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">The PNPM lockfile</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_C0d9 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#commonjs-module-resolution" class="table-of-contents__link toc-highlight">CommonJS module resolution</a><ul><li><a href="#-tracing-commonjs-resolution" class="table-of-contents__link toc-highlight">🔍 Tracing CommonJS resolution</a></li></ul></li><li><a href="#es-module-resolution" class="table-of-contents__link toc-highlight">ES module resolution</a></li><li><a href="#typescript-module-resolution" class="table-of-contents__link toc-highlight">TypeScript module resolution</a><ul><li><a href="#-tracing-typescript-resolution" class="table-of-contents__link toc-highlight">🔍 Tracing TypeScript resolution</a></li></ul></li><li><a href="#see-also" class="table-of-contents__link toc-highlight">See also</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">© 2024 Microsoft</div></div></div></footer></div>
<script src="/assets/js/runtime~main.e45596cc.js"></script>
<script src="/assets/js/main.d70b02e8.js"></script>
</body>
</html>