<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-pages/concepts/tracing_resolution">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="search" type="application/opensearchdescription+xml" title="Lockfile Explorer" href="/opensearch.xml">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic"><title data-rh="true">Tracing package resolution | Lockfile Explorer</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lfx.rushstack.io/images/site/lfx-ograph.jpg"><meta data-rh="true" name="twitter:image" content="https://lfx.rushstack.io/images/site/lfx-ograph.jpg"><meta data-rh="true" property="og:url" content="https://lfx.rushstack.io/pages/concepts/tracing_resolution/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Tracing package resolution | Lockfile Explorer"><link data-rh="true" rel="icon" href="/images/site/favicon.ico"><link data-rh="true" rel="canonical" href="https://lfx.rushstack.io/pages/concepts/tracing_resolution/"><link data-rh="true" rel="alternate" href="https://lfx.rushstack.io/pages/concepts/tracing_resolution/" hreflang="en"><link data-rh="true" rel="alternate" href="https://lfx.rushstack.io/pages/concepts/tracing_resolution/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.9a4b9909.css">
<link rel="preload" href="/assets/js/runtime~main.40ff2eaf.js" as="script">
<link rel="preload" href="/assets/js/main.8d932986.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div class="suiteNavBar_rHPh"><div role="button" class="hamburger_AuD3 hamburgerInteraction_B9ML"><img src="/images/suitenav/rs-hamburger.svg"></div><div class="hamburgerDivider_zNDB"></div><a href="https://rushstack.io/pages/overview/roadmap/" class="suiteNavItem_tL2w">Roadmap</a><a href="https://rushstack.io/pages/shop/" class="suiteNavItem_tL2w">Shop</a><a href="https://rushstack.io/community/events/" class="suiteNavItem_tL2w">Events</a></div><div role="region"><a href="#" class="skipToContent_yHtx">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/site/lockfile-explorer.svg" alt="Lockfile Explorer" class="themedImage_xqNz themedImage--light_NH9z"><img src="/images/site/lockfile-explorer.svg" alt="Lockfile Explorer" class="themedImage_xqNz themedImage--dark_aoV8"></div><b class="navbar__title text--truncate"></b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_Do5L"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/pages/concepts/tracing_resolution/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/pages/basics/getting_started/">Docs</a><a class="navbar__item navbar__link" href="/pages/support/news/">News</a><a class="navbar__item navbar__link" href="/pages/support/contributing/">GitHub</a><a class="navbar__item navbar__link" href="/pages/support/help/">Help</a><div class="searchBox_Royc"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_jj2R docsWrapper__pZK"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_iDCD" type="button"></button><div class="docPage_mREL"><aside class="theme-doc-sidebar-container docSidebarContainer_RfV8"><div class="sidebar_khl0"><nav class="menu thin-scrollbar menu_usJe"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Introduction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/basics/getting_started/">Getting started</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">Versioning Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/concepts/version_conflicts/">Version conflicts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/concepts/semver/">SemVer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/concepts/install_models/">Installation models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/pages/concepts/tracing_resolution/">Tracing package resolution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/concepts/strict_settings/">Strict settings</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Scenarios</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/scenarios/demos_repo/">Demos repository</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/scenarios/side-by-side_versions/">Side-by-side versions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/scenarios/peer_dependencies/">Peer dependencies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/scenarios/npm_doppelgangers/">NPM doppelgangers</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Support</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/support/help/">Help</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/support/news/">What&#x27;s new</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/support/contributing/">Contributing</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_Spkt"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_B0FM"><div class="docItemContainer_urdu"><article><div class="tocCollapsible_fai6 theme-doc-toc-mobile tocMobile_AbM5"><button type="button" class="clean-btn tocCollapsibleButton_Vjdw">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Tracing package resolution</h1></header><h2 class="anchor anchorWithStickyNavbar_SLHE" id="commonjs-module-resolution">CommonJS module resolution<a class="hash-link" href="#commonjs-module-resolution" title="Direct link to heading">​</a></h2><p>If you are using the NPM or PNPM <a href="/pages/concepts/install_models/">installation model</a> (versus PnP),
the CommonJS <code>require()</code> API performs module resolution by traversing physical folders on disk.
This helps with troubleshooting, because many problems can be understood simply by inspecting folders
using your shell.  The complete algorithm is detailed in
<a href="https://nodejs.org/api/modules.html#all-together" target="_blank" rel="noopener noreferrer">the Node.js specification</a>, but approximately it works
like this (ignoring many details such as import path mappings):</p><ol><li><p>If your import path starts with <code>.</code> or <code>..</code> or <code>/</code> (for example <code>require(&#x27;./path/to/file&#x27;)</code>),
then the entire string will be interpreted as a file path.</p></li><li><p>Otherwise, the first part will be interpreted as an NPM package name.  For example
<code>require(&#x27;one/two/three&#x27;)</code> would look for an NPM package called <code>one</code>,
and <code>require(&#x27;@company/one/two/three&#x27;)</code> would look for an NPM package <code>@company/one</code>.</p></li><li><p>If the API call <code>require(&#x27;@company/one/two/three&#x27;)</code> is performed by a script <code>/a/b/c/d/e.js</code>, then
the module resolver will look for the <code>@company/one</code> install folder by searching in <code>node_modules</code> folders
in parent folders.  In our example, these paths would be checked (approximately, ignoring many details):</p><ul><li><code>/a/b/c/d/node_modules/@company/one/package.json</code></li><li><code>/a/b/c/node_modules/@company/one/package.json</code></li><li><code>/a/b/node_modules/@company/one/package.json</code></li><li><code>/a/node_modules/@company/one/package.json</code></li><li><code>/node_modules/@company/one/package.json</code></li></ul><p>The first match is used, ignoring other possible matches.  If no match is found, then <code>require()</code> fails
by throwing an exception.</p></li><li><p>Once a match is found, the <code>two/three</code> remaining path is evaluated relative to the <code>@company/one</code> install folder.
Let&#x27;s suppose that <code>/a/b/node_modules/@company/one/package.json</code> was the found match; then (if there are no
import path mappings) the resolved script will be <code>/a/b/node_modules/@company/one/two/three.js</code>.</p></li><li><p>If the remaining path is an empty string (for example <code>require(&#x27;@company/one&#x27;)</code>), then a default path will be used.
The default path would be <code>/a/b/node_modules/@company/one/index.js</code>, but most likely an explicit path will be
specified by a <strong>package.json</strong> field such as <code>&quot;main&quot;</code>.  For example, with <code>&quot;main&quot;: &quot;dist/one.js&quot;</code>,
the final path instead would be <code>/a/b/node_modules/@company/one/dist/one.js</code>.</p></li></ol><p>A couple important things to understand about this algorithm:</p><ul><li><p><strong>Phantom dependencies are possible:</strong>
The <code>node_modules</code> folder was probably created by <code>pnpm install</code> based on some <strong>package.json</strong> file,
most likely the package that owns our script <code>/a/b/c/d/e.js</code>.  However, at no point does the algorithm
read THAT <strong>package.json</strong> file.  Resolution only considers <code>node_modules</code> folders, regardless of how they
were created.  This is the fundamental design flaw that makes
<a href="https://rushjs.io/pages/advanced/phantom_deps/" target="_blank" rel="noopener noreferrer">phantom dependencies</a> possible, as well as &quot;hoisting&quot; which is the
questionable practice of intentionally introducing phantom dependencies.</p></li><li><p><strong>Symlinks get normalized:</strong>  When a module is imported via a symlink, the script path is normalized
by calling <a href="https://nodejs.org/api/fs.html#fspromisesrealpathpath-options" target="_blank" rel="noopener noreferrer">fs.realpath()</a>
to eliminate any symlinks, so that Step 3 will visit parent folders from the physical path
instead of the logical (with symlinks) path.</p><p>For example: suppose that <code>/my-repo/my-app/node_modules/my-library</code> is actually a symlink to
<code>/my-repo/my-library</code>, and the executing script was imported as <code>./node_modules/my-library/dist/bundle.js</code>.
When <code>bundle.js</code> calls <code>require(&#x27;some-other-library&#x27;)</code>, the searched parent folder will be
<code>/my-repo/my-library/node_modules/</code>, NOT <code>/my-repo/my-app/node_modules</code>.  This feature is what makes
the PNPM installation model possible.</p><p>(This was not true in ancient versions of Node.js; see the
<a href="https://nodejs.org/api/all.html#cli_preserve_symlinks" target="_blank" rel="noopener noreferrer">--preserve-symlinks</a> docs for details.)</p></li></ul><h3 class="anchor anchorWithStickyNavbar_SLHE" id="-tracing-commonjs-resolution">🔍 Tracing CommonJS resolution<a class="hash-link" href="#-tracing-commonjs-resolution" title="Direct link to heading">​</a></h3><p>Let&#x27;s try a hands-on experiment, to see how CommonJS resolution can be traced by inspecting folders on disk.</p><p>1<!-- -->. Clone and install the <a href="https://github.com/microsoft/lockfile-explorer-demos/tree/demo/sample-1" target="_blank" rel="noopener noreferrer">demo/sample-1</a>
branch from the <a href="https://github.com/microsoft/lockfile-explorer-demos/" target="_blank" rel="noopener noreferrer">lockfile-explorer-demos</a>
demo repo. <strong><em>You will need to launch the Verdaccio service in a separate shell window.</em></strong>  See the
<a href="/pages/scenarios/demos_repo/">Demos repository</a> topic for instructions.</p><p>Recall that the <code>demo/sample-1</code> lockfile looks like this:</p><img loading="lazy" src="/images/docs/lfx-demo-sample-1.svg" alt="dependency graph: demo/sample-1" class="img_IZrY"><p>After running <code>rush install</code> in the <code>~/lockfile-explorer-demos/</code> folder, the project B should
have the following files:</p><ul><li><code>~/lockfile-explorer-demos/projects/b/package.json</code>: defines the package</li><li><code>~/lockfile-explorer-demos/projects/b/index.js</code>: some placeholder source code</li><li><code>~/lockfile-explorer-demos/projects/b/node_modules/@rushstack/d/</code>: installed folder for dependency D</li><li><code>~/lockfile-explorer-demos/projects/b/node_modules/@rushstack/n/</code>: installed folder for dependency N</li></ul><p>Observe that PNPM has created symlinks in the <code>b/node_modules</code> folder. We can inspect them using the shell:</p><div class="tabs-container tabList_dxiR"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_znke tabs__item--active">Bash</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_znke">PowerShell</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_znke">DOS</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_o_Vg"><div class="language-bash codeBlockContainer_rOsD theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RK14"><pre tabindex="0" class="prism-code language-bash codeBlock_O81Q thin-scrollbar"><code class="codeBlockLines_oxQH"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> -l ~/lockfile-explorer-demos/projects/b/node_modules/</span><br></span></code></pre><div class="buttonGroup_U8U_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_ZlfJ" aria-hidden="true"><svg class="copyButtonIcon_Yhmw" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_vhcl" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>  Output:</p><div class="codeBlockContainer_rOsD theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RK14"><pre tabindex="0" class="prism-code language-text codeBlock_O81Q thin-scrollbar"><code class="codeBlockLines_oxQH"><span class="token-line" style="color:#393A34"><span class="token plain">lrwxrwxrwx 1 d -&gt; /home/yourself/lockfile-explorer-demos/projects/d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lrwxrwxrwx 1 n -&gt; /home/yourself/lockfile-explorer-demos/common/temp/node_modules/.pnpm/@rushstack+n@2.0.0/node_modules/@rushstack/n/</span><br></span></code></pre><div class="buttonGroup_U8U_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_ZlfJ" aria-hidden="true"><svg class="copyButtonIcon_Yhmw" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_vhcl" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_o_Vg" hidden=""><div class="language-powershell codeBlockContainer_rOsD theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RK14"><pre tabindex="0" class="prism-code language-powershell codeBlock_O81Q thin-scrollbar"><code class="codeBlockLines_oxQH"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">dir</span><span class="token plain"> projects\b\node_modules\@rushstack\ </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">select</span><span class="token plain"> Name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">LinkType</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Target</span><br></span></code></pre><div class="buttonGroup_U8U_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_ZlfJ" aria-hidden="true"><svg class="copyButtonIcon_Yhmw" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_vhcl" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>  Output:</p><div class="codeBlockContainer_rOsD theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RK14"><pre tabindex="0" class="prism-code language-text codeBlock_O81Q thin-scrollbar"><code class="codeBlockLines_oxQH"><span class="token-line" style="color:#393A34"><span class="token plain">Name LinkType Target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---- -------- ------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d    Junction {C:\Git\lockfile-explorer-demos\projects\d\}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">n    Junction {C:\Git\lockfile-explorer-demos\common\temp\node_modules\.pnpm\@rushstack+n@2.0.0\node_modules\@rushstack\n\}</span><br></span></code></pre><div class="buttonGroup_U8U_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_ZlfJ" aria-hidden="true"><svg class="copyButtonIcon_Yhmw" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_vhcl" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_o_Vg" hidden=""><div class="language-batch codeBlockContainer_rOsD theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RK14"><pre tabindex="0" class="prism-code language-batch codeBlock_O81Q thin-scrollbar"><code class="codeBlockLines_oxQH"><span class="token-line" style="color:#393A34"><span class="token command keyword" style="color:#00009f">dir</span><span class="token command"> node_modules\@rushstack\</span><br></span></code></pre><div class="buttonGroup_U8U_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_ZlfJ" aria-hidden="true"><svg class="copyButtonIcon_Yhmw" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_vhcl" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>  Output:</p><div class="codeBlockContainer_rOsD theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RK14"><pre tabindex="0" class="prism-code language-text codeBlock_O81Q thin-scrollbar"><code class="codeBlockLines_oxQH"><span class="token-line" style="color:#393A34"><span class="token plain">Directory of C:\Git\lockfile-explorer-demos\projects\b\node_modules\@rushstack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12/01/2022  03:11 PM    &lt;DIR&gt;          .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12/01/2022  03:11 PM    &lt;DIR&gt;          ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12/01/2022  03:11 PM    &lt;JUNCTION&gt;     d [C:\Git\lockfile-explorer-demos\projects\d]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12/01/2022  03:11 PM    &lt;JUNCTION&gt;     n [C:\Git\lockfile-explorer-demos\common\temp\node_modules\.pnpm\@rushstack+n@2.0.0\node_modules\@rushstack\n]</span><br></span></code></pre><div class="buttonGroup_U8U_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_ZlfJ" aria-hidden="true"><svg class="copyButtonIcon_Yhmw" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_vhcl" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p>Observe that:</p><ul><li><code>node_modules/@rushstack/d</code> gets symlinked to <code>projects/d</code> because <code>b/package.json</code> declared
it as a local workspace dependency (<code>&quot;@rushstack/d&quot;: &quot;workspace:*&quot;</code>)</li><li><code>node_modules/@rushstack/d</code> gets symlinked to a folder under <code>common/temp</code> because
<code>b/package.json</code> declared it as an external dependency, installed from the NPM registry
(<code>&quot;@rushstack/n&quot;: &quot;^2.0.0&quot;</code>)</li></ul><blockquote><p>Note: Rush silently forces <a href="https://pnpm.io/npmrc#link-workspace-packages" target="_blank" rel="noopener noreferrer">--link-workspace-packages=false</a>
which ensures that the <code>workspace:</code> prefix unambiguously determines whether a dependency will be linked
locally versus externally. If you are using PNPM without Rush, it&#x27;s instead decided by an implicit heuristic.</p></blockquote><p>We can confirm this by calling the
<a href="https://nodejs.org/api/modules.html#requireresolverequest-options" target="_blank" rel="noopener noreferrer">Node.js require.resolve()</a>
API:</p><div class="language-bash codeBlockContainer_rOsD theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RK14"><pre tabindex="0" class="prism-code language-bash codeBlock_O81Q thin-scrollbar"><code class="codeBlockLines_oxQH"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># From the folder of project B...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> ~/lockfile-explorer-demos/projects/b/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ...call the require.resolve() API to print out the target path for D:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> -e console.log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">require.resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;@rushstack/d&#x27;</span><span class="token punctuation" style="color:#393A34">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Expected output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># /home/yourself/lockfile-explorer-demos/projects/d/index.js</span><br></span></code></pre><div class="buttonGroup_U8U_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_ZlfJ" aria-hidden="true"><svg class="copyButtonIcon_Yhmw" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_vhcl" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now let&#x27;s follow the chain a step further.  At runtime, suppose that A imports a file from D,
and then D in turn tries to import N.  Will it work?  We might try this experiment:</p><div class="language-bash codeBlockContainer_rOsD theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RK14"><pre tabindex="0" class="prism-code language-bash codeBlock_O81Q thin-scrollbar"><code class="codeBlockLines_oxQH"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># INCORRECT METHOD</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># From the folder of project B/D...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> ~/lockfile-explorer-demos/projects/b/node_modules/@rushstack/d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ...call the require.resolve() API to print out the target path for N:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> -e console.log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">require.resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;@rushstack/n&#x27;</span><span class="token punctuation" style="color:#393A34">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Expected output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># /home/yourself/lockfile-explorer-demos/common/temp/node_modules/.pnpm/@rushstack+n@2.0.0/node_modules/@rushstack/n/index.js</span><br></span></code></pre><div class="buttonGroup_U8U_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_ZlfJ" aria-hidden="true"><svg class="copyButtonIcon_Yhmw" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_vhcl" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>According to the diagram, this should NOT work, because D</p><blockquote><p>Warning: If you&#x27;re creating a tool that needs to resolve imports, do not write your own code that
traverses <code>node_modules</code> folders.  The presentation here is greatly simplified for learning purposes;
the full algorithm is complex and difficult to implement correctly.  Instead, use a standard API such as
<a href="https://nodejs.org/api/modules.html#requireresolverequest-options" target="_blank" rel="noopener noreferrer">require.resolve()</a>,
<a href="https://api.rushstack.io/pages/node-core-library.import/" target="_blank" rel="noopener noreferrer">node-core-library Import</a>,
or the <a href="https://www.npmjs.com/package/resolve" target="_blank" rel="noopener noreferrer">resolve</a> NPM package.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_SLHE" id="es-module-resolution">ES module resolution<a class="hash-link" href="#es-module-resolution" title="Direct link to heading">​</a></h2><ul><li><code>&quot;module&quot;</code> used by runtimes supporting ESNext modules, for example the Webpack bundler.
For example: <code>&quot;module&quot;: &quot;dist/one.esm.js&quot;</code></li></ul><h2 class="anchor anchorWithStickyNavbar_SLHE" id="typescript-module-resolution">TypeScript module resolution<a class="hash-link" href="#typescript-module-resolution" title="Direct link to heading">​</a></h2><ul><li><code>&quot;typings&quot;</code> or <code>&quot;types&quot;</code> used only by the TypeScript compiler.  (If it&#x27;s missing, the compiler will
look in the same folder as the runtime <code>.js</code> file.)
For example: <code>&quot;typings&quot;: &quot;dist/one.d.ts&quot;</code></li></ul><h3 class="anchor anchorWithStickyNavbar_SLHE" id="-tracing-typescript-resolution">🔍 Tracing TypeScript resolution<a class="hash-link" href="#-tracing-typescript-resolution" title="Direct link to heading">​</a></h3><h2 class="anchor anchorWithStickyNavbar_SLHE" id="see-also">See also<a class="hash-link" href="#see-also" title="Direct link to heading">​</a></h2><ul><li><a href="https://www.npmjs.com/package/@rushstack/trace-import" target="_blank" rel="noopener noreferrer">@<!-- -->rushstack/trace-import</a>: Our command-line tool for troubleshooting how modules are resolved by <code>import</code> and <code>require()</code></li><li><a href="https://nodejs.org/api/modules.html#all-together" target="_blank" rel="noopener noreferrer">Node.js require()</a> specification and algorithm</li><li><a href="https://nodejs.org/api/modules.html#requireresolverequest-options" target="_blank" rel="noopener noreferrer">Node.js require.resolve()</a> API docs</li><li><a href="https://api.rushstack.io/pages/node-core-library.import/" target="_blank" rel="noopener noreferrer">node-core-library Import</a>: the Rush Stack API
which provides similar functionality as <code>require.resolve()</code> but with improved TypeScript typings and some
additional features</li><li><a href="https://www.npmjs.com/package/resolve" target="_blank" rel="noopener noreferrer">resolve</a>: a standalone NPM package that implements
<code>require.resolve()</code> algorithm with the ability to specify a base folder (it is used internally
by <code>Import</code>)</li><li><a href="https://docs.npmjs.com/cli/v6/configuring-npm/package-json" target="_blank" rel="noopener noreferrer">package.json fields</a> docs from NPM</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/microsoft/rushstack-websites/tree/main/websites/lfx.rushstack.io/docs/pages/concepts/tracing_resolution.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_BLyC" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_w8CT"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/pages/concepts/install_models/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Installation models</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/pages/concepts/strict_settings/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Strict settings</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_PJGn thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#commonjs-module-resolution" class="table-of-contents__link toc-highlight">CommonJS module resolution</a><ul><li><a href="#-tracing-commonjs-resolution" class="table-of-contents__link toc-highlight">🔍 Tracing CommonJS resolution</a></li></ul></li><li><a href="#es-module-resolution" class="table-of-contents__link toc-highlight">ES module resolution</a></li><li><a href="#typescript-module-resolution" class="table-of-contents__link toc-highlight">TypeScript module resolution</a><ul><li><a href="#-tracing-typescript-resolution" class="table-of-contents__link toc-highlight">🔍 Tracing TypeScript resolution</a></li></ul></li><li><a href="#see-also" class="table-of-contents__link toc-highlight">See also</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">© 2022 Microsoft</div></div></div></footer></div>
<script src="/assets/js/runtime~main.40ff2eaf.js"></script>
<script src="/assets/js/main.8d932986.js"></script>
</body>
</html>