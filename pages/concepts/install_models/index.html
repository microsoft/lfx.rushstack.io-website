<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-pages/concepts/install_models">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="search" type="application/opensearchdescription+xml" title="Lockfile Explorer" href="/opensearch.xml">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic"><title data-rh="true">Installation models | Lockfile Explorer</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lfx.rushstack.io/images/site/lfx-ograph.jpg"><meta data-rh="true" name="twitter:image" content="https://lfx.rushstack.io/images/site/lfx-ograph.jpg"><meta data-rh="true" property="og:url" content="https://lfx.rushstack.io/pages/concepts/install_models/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Installation models | Lockfile Explorer"><meta data-rh="true" name="description" content="Installing a package involves downloading an archive and extracting its files into a folder on disk,"><meta data-rh="true" property="og:description" content="Installing a package involves downloading an archive and extracting its files into a folder on disk,"><link data-rh="true" rel="icon" href="/images/site/favicon.ico"><link data-rh="true" rel="canonical" href="https://lfx.rushstack.io/pages/concepts/install_models/"><link data-rh="true" rel="alternate" href="https://lfx.rushstack.io/pages/concepts/install_models/" hreflang="en"><link data-rh="true" rel="alternate" href="https://lfx.rushstack.io/pages/concepts/install_models/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.34967ffb.css">
<link rel="preload" href="/assets/js/runtime~main.5e90992f.js" as="script">
<link rel="preload" href="/assets/js/main.e7d177b0.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div class="suiteNavBar_rHPh"><div role="button" class="hamburger_AuD3 hamburgerInteraction_B9ML"><img src="/images/suitenav/rs-hamburger.svg"></div><div class="hamburgerDivider_zNDB"></div><a href="https://rushstack.io/pages/overview/roadmap/" class="suiteNavItem_tL2w">Roadmap</a><a href="https://rushstack.io/pages/shop/" class="suiteNavItem_tL2w">Shop</a><a href="https://rushstack.io/community/events/" class="suiteNavItem_tL2w">Events</a></div><div role="region"><a href="#" class="skipToContent_yHtx">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/site/lockfile-explorer.svg" alt="Lockfile Explorer" class="themedImage_xqNz themedImage--light_NH9z"><img src="/images/site/lockfile-explorer.svg" alt="Lockfile Explorer" class="themedImage_xqNz themedImage--dark_aoV8"></div><b class="navbar__title text--truncate"></b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_Do5L"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/pages/concepts/install_models/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/pages/basics/getting_started/">Docs</a><a class="navbar__item navbar__link" href="/pages/support/news/">News</a><a class="navbar__item navbar__link" href="/pages/support/contributing/">GitHub</a><a class="navbar__item navbar__link" href="/pages/support/help/">Help</a><div class="searchBox_Royc"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_jj2R docsWrapper__pZK"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_iDCD" type="button"></button><div class="docPage_mREL"><aside class="theme-doc-sidebar-container docSidebarContainer_RfV8"><div class="sidebar_khl0"><nav class="menu thin-scrollbar menu_usJe"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Introduction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/basics/getting_started/">Getting started</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">Versioning Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/concepts/version_conflicts/">Version conflicts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/concepts/semver/">SemVer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/pages/concepts/install_models/">Installation models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/concepts/tracing_resolution/">Tracing package resolution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/concepts/pnpm_lockfile/">The PNPM lockfile</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/concepts/strict_settings/">Strict settings</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Scenarios</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/scenarios/demos_repo/">Demos repository</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/scenarios/side-by-side_versions/">Side-by-side versions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/scenarios/peer_dependencies/">Peer dependencies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/scenarios/npm_doppelgangers/">NPM doppelgangers</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Support</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/support/help/">Help</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/support/news/">What&#x27;s new</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/support/contributing/">Contributing</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_Spkt"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_B0FM"><div class="docItemContainer_urdu"><article><div class="theme-doc-markdown markdown"><header><h1>Installation models</h1></header><p>Installing a package involves downloading an archive and extracting its files into a folder on disk,
for example into the <code>node_modules</code> folder tree. We&#x27;ll use the term <strong>installation model</strong> to describe
the mechanics of this process. Unlike most other programming languages, there are multiple installation models
in common use for Node.js today:</p><ol><li><p><strong>NPM installation model</strong> - The classic <code>node_modules</code> layout, currently used by <a href="https://www.npmjs.com/" target="_blank" rel="noopener noreferrer">NPM</a>
as well as <a href="https://classic.yarnpkg.com/lang/en/" target="_blank" rel="noopener noreferrer">Yarn Classic</a>.
The fundamental design of this algorithm unavoidably produces
<a href="https://rushjs.io/pages/advanced/phantom_deps/" target="_blank" rel="noopener noreferrer">phantom dependencies</a>
(ability to import files that were not declared in <strong>package.json</strong>), as well as
<a href="https://rushjs.io/pages/advanced/npm_doppelgangers/" target="_blank" rel="noopener noreferrer">NPM doppelgangers</a>
(duplicate installations of the same version of the same package).
NPM&#x27;s implementation also produces
<a href="http://npm.github.io/how-npm-works-docs/npm3/non-determinism.html" target="_blank" rel="noopener noreferrer">nondeterministic installations</a>
depending on the order in which CLI comands are invoked.
The later installation models can all be understood as attempts to mitigate these design flaws,
with different tradeoffs for backwards compatibility with legacy packages.</p></li><li><p><strong>PNPM installation model</strong> - The <a href="https://pnpm.io/" target="_blank" rel="noopener noreferrer">PNPM</a> package manager introduced a completely
different <code>node_modules</code> layout that relies heavily on <a href="https://en.wikipedia.org/wiki/Symbolic_link" target="_blank" rel="noopener noreferrer">symlinks</a>.
This completely eliminates the problem of <strong>NPM doppelgangers</strong> (although <strong>peer doppelgangers</strong> are still
possible). It also can completely eliminate <strong>phantom dependencies</strong>,
depending on the <a href="https://pnpm.io/npmrc#dependency-hoisting-settings" target="_blank" rel="noopener noreferrer">dependency hoisting</a> configuration.
The resulting <code>node_modules</code> structure is somewhat convoluted, but its big advantage is excellent
backwards compatibility with legacy code that resolves modules by traversing the <code>node_modules</code> tree.
(Compatibility fixes are sometimes required, but in most cases the fix is very simple, and today almost every
popular package has been fixed.) Yarn now also optionally supports the PNPM installation model via
the <a href="https://yarnpkg.com/api/modules/plugin_pnpm.html" target="_blank" rel="noopener noreferrer">@yarnpkg/plugin-pnpm</a> plugin.</p></li><li><p><strong>Plug&#x27;n&#x27;Play (PnP) installation model</strong> - The <a href="https://yarnpkg.com/" target="_blank" rel="noopener noreferrer">Yarn</a> package manager took a different
approach, by introducing a hook called <a href="https://yarnpkg.com/features/pnp" target="_blank" rel="noopener noreferrer">Plug&#x27;n&#x27;Play</a> that allows the Node.js
<code>require()</code> API to be patched with a completely different implementation. The basic concept is that <code>yarn install</code>
will generate a patch script <code>.pnp.cjs</code>, and then Node.js gets invoked with <code>NODE_OPTIONS=&quot;--require $(pwd)/.pnp.cjs&quot;</code>.
The script is expected to implement the <a href="https://yarnpkg.com/advanced/pnpapi" target="_blank" rel="noopener noreferrer">PnP API</a> contract, although there
is currently no spec for how module resolution might be performed by a tool that cannot execute arbitrary
JavaScript code (for example a Java service). Because it fundamentally redesigns the semantics of <code>require()</code>,
Plug&#x27;n&#x27;Play offers significant improvements in both features and performance; however it has struggled to gain
widespread adoption due to compatibility challenges for existing NPM packages. The PNPM package manager
now optionally supports the Plug&#x27;n&#x27;Play installation model via
the <a href="https://pnpm.io/npmrc#node-linker" target="_blank" rel="noopener noreferrer">node-linker=pnp</a> setting.</p></li><li><p><strong>Rush legacy symlinking</strong> - Rush implemented its own
<a href="https://github.com/microsoft/rushstack/blob/main/libraries/rush-lib/src/logic/npm/NpmLinkManager.ts" target="_blank" rel="noopener noreferrer">symlinking installation model</a>
which predates the Yarn and PNPM workspace features. This model is used when <code>useWorkspaces=false</code>
in <a href="https://rushjs.io/pages/configs/pnpm-config_json/" target="_blank" rel="noopener noreferrer">pnpm-config.json</a>, or if the Yarn or NPM package manager
is selected in <strong>rush.json</strong>. This algorithm is still supported but not recommended.</p></li></ol><p>Rush Stack recommends the <strong>PNPM installation model</strong> for monorepos, because it currently seems to provide
the best tradeoff between correctness and backwards compatibility. It is the default and best supported
installation mode for the Rush build orchestrator. It is the only model supported by Lockfile Explorer,
although in the future we expect to implement support for other lockfile formats.</p><blockquote><p>PNPM&#x27;s <a href="https://pnpm.io/feature-comparison" target="_blank" rel="noopener noreferrer">Feature Comparison</a> summarizes some other interesting
differences between package managers, beyond the installation models that they support.</p></blockquote><blockquote><p>The acronyms &quot;PnP&quot; and &quot;PNPM&quot; are easy to confuse: PnP (Plug&#x27;n&#x27;Play) is an installation model,
whereas PNPM is a package manager whose default installation model is not PnP.</p></blockquote></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/microsoft/rushstack-websites/tree/main/websites/lfx.rushstack.io/docs/pages/concepts/install_models.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_BLyC" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_w8CT"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/pages/concepts/semver/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">SemVer</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/pages/concepts/tracing_resolution/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Tracing package resolution</div></a></nav></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">© 2022 Microsoft</div></div></div></footer></div>
<script src="/assets/js/runtime~main.5e90992f.js"></script>
<script src="/assets/js/main.e7d177b0.js"></script>
</body>
</html>