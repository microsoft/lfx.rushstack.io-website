<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-pages/concepts/pnpm_lockfile">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="search" type="application/opensearchdescription+xml" title="Lockfile Explorer" href="/opensearch.xml">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic"><title data-rh="true">The PNPM lockfile | Lockfile Explorer</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lfx.rushstack.io/images/site/lfx-ograph.jpg"><meta data-rh="true" name="twitter:image" content="https://lfx.rushstack.io/images/site/lfx-ograph.jpg"><meta data-rh="true" property="og:url" content="https://lfx.rushstack.io/pages/concepts/pnpm_lockfile/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="The PNPM lockfile | Lockfile Explorer"><meta data-rh="true" name="description" content="The previous sections covered the basics of version conflicts, SemVer, and installation models."><meta data-rh="true" property="og:description" content="The previous sections covered the basics of version conflicts, SemVer, and installation models."><link data-rh="true" rel="icon" href="/images/site/favicon.ico"><link data-rh="true" rel="canonical" href="https://lfx.rushstack.io/pages/concepts/pnpm_lockfile/"><link data-rh="true" rel="alternate" href="https://lfx.rushstack.io/pages/concepts/pnpm_lockfile/" hreflang="en"><link data-rh="true" rel="alternate" href="https://lfx.rushstack.io/pages/concepts/pnpm_lockfile/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.34967ffb.css">
<link rel="preload" href="/assets/js/runtime~main.ae9b29fa.js" as="script">
<link rel="preload" href="/assets/js/main.78db02df.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div class="suiteNavBar_rHPh"><div role="button" class="hamburger_AuD3 hamburgerInteraction_B9ML"><img src="/images/suitenav/rs-hamburger.svg"></div><div class="hamburgerDivider_zNDB"></div><a href="https://rushstack.io/pages/overview/roadmap/" class="suiteNavItem_tL2w">Roadmap</a><a href="https://rushstack.io/pages/shop/" class="suiteNavItem_tL2w">Shop</a><a href="https://rushstack.io/community/events/" class="suiteNavItem_tL2w">Events</a></div><div role="region"><a href="#" class="skipToContent_yHtx">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/site/lockfile-explorer.svg" alt="Lockfile Explorer" class="themedImage_xqNz themedImage--light_NH9z"><img src="/images/site/lockfile-explorer.svg" alt="Lockfile Explorer" class="themedImage_xqNz themedImage--dark_aoV8"></div><b class="navbar__title text--truncate"></b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_Do5L"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/pages/concepts/pnpm_lockfile/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/pages/basics/getting_started/">Docs</a><a class="navbar__item navbar__link" href="/pages/support/news/">News</a><a class="navbar__item navbar__link" href="/pages/support/contributing/">GitHub</a><a class="navbar__item navbar__link" href="/pages/support/help/">Help</a><div class="searchBox_Royc"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_jj2R docsWrapper__pZK"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_iDCD" type="button"></button><div class="docPage_mREL"><aside class="theme-doc-sidebar-container docSidebarContainer_RfV8"><div class="sidebar_khl0"><nav class="menu thin-scrollbar menu_usJe"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Introduction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/basics/getting_started/">Getting started</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">Versioning Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/concepts/version_conflicts/">Version conflicts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/concepts/semver/">SemVer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/concepts/install_models/">Installation models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/concepts/tracing_resolution/">Tracing package resolution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/pages/concepts/pnpm_lockfile/">The PNPM lockfile</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/concepts/strict_settings/">Strict settings</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Scenarios</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/scenarios/demos_repo/">Demos repository</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/scenarios/side-by-side_versions/">Side-by-side versions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/scenarios/peer_dependencies/">Peer dependencies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/scenarios/npm_doppelgangers/">NPM doppelgangers</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Support</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/support/help/">Help</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/support/news/">What&#x27;s new</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pages/support/contributing/">Contributing</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_Spkt"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_B0FM"><div class="docItemContainer_urdu"><article><div class="tocCollapsible_fai6 theme-doc-toc-mobile tocMobile_AbM5"><button type="button" class="clean-btn tocCollapsibleButton_Vjdw">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>The PNPM lockfile</h1></header><p>The previous sections covered the basics of version conflicts, SemVer, and installation models.
We&#x27;re now ready to examine the package lockfile in detail. In a nutshell, it stores an
<strong>installation plan</strong> for how the <code>node_modules</code> folder should get installed, according to the
<a href="/pages/concepts/install_models/">installation model</a> in use. From now on, we&#x27;ll assume that it&#x27;s the
PNPM installation model, and so the filename is <code>pnpm-lock.yaml</code>.</p><h2 class="anchor anchorWithStickyNavbar_SLHE" id="why-do-we-need-a-lockfile">Why do we need a lockfile?<a class="hash-link" href="#why-do-we-need-a-lockfile" title="Direct link to heading">​</a></h2><p>Suppose hypothetically that we did not have a <code>pnpm-lock.yaml</code> file stored in Git, and suppose also that
<code>my-app/package.json</code> has a dependency on <code>&quot;react&quot;: &quot;^18.0.0&quot;</code>. Let&#x27;s say today is May 1st, and the latest release
from the 18 series is <code>react@18.1.0</code>. Without a lockfile, that is what PNPM would choose to install.
Latest is greatest, right? Well, consider a few hypothetical scenarios:</p><ol><li><p><strong>Ability to reproduce an error.</strong> Some time passes, and it&#x27;s now June 15th. When you install <code>my-app</code>,
the latest version is now <code>react@18.2.0</code>. Suppose the app malfunctions because of a change introduced in
that version. But when you ask a teammate for help, they don&#x27;t know what you&#x27;re talking about. <em>&quot;Everything
runs fine on my computer!&quot;</em> The reason is that their <code>node_modules</code> folder still has the old <code>react@18.1.0</code>.</p></li><li><p><strong>Building old branches.</strong> To investigate, you remember that the project worked successfully a week ago,
so you decide to try checking out older versions of the Git branch. By pinpointing the commit that
broke things, maybe you can compare the diff to find the change that broke things. However because there is
no lockfile, those old branches are all now failing as well, because <code>react@18.2.0</code> is getting installed
instead of <code>react@18.1.0</code>.</p></li><li><p><strong>Deterministic releases.</strong> But that means... The next time we deploy to production, it&#x27;s going to
include <code>react@18.2.0</code> and cause a customer incident. Uh oh! Essentially, we&#x27;re deploying something
different from what we tested. How can we pin the version back to <code>react@18.1.0</code> for a given branch?</p></li></ol><p>A naive solution would be to change <code>&quot;react&quot;: &quot;^18.0.0&quot;</code> to <code>&quot;react&quot;: &quot;18.1.0&quot;</code> in <code>my-app/package.json</code>,
however this only affects direct dependencies of your project. A typical <code>node_modules</code> folder may contain
thousands of NPM packages, most of which are dependencies-of-dependencies, whose version range is determined
by an external <code>package.json</code> file.</p><h2 class="anchor anchorWithStickyNavbar_SLHE" id="what-does-a-lockfile-store">What does a lockfile store?<a class="hash-link" href="#what-does-a-lockfile-store" title="Direct link to heading">​</a></h2><p>The package lockfile is the ideal solution to the above problem: It records the exact version number of every
single package in your <code>node_modules</code> folder, along with topological information such as peer dependency
relationships. This enables the package manager to reproduce the exact same <code>node_modules</code> folder structure
regardless of whatever the &quot;latest&quot; versions might be on that day. The <code>pnpm-lock.yaml</code> file is serialized as
human-readable text, in a format whose diff minimizes Git merge conflicts as much as possible. The file format
also carefully avoids storing extra information that might not be portable between operating systems
or NPM registry configurations.</p><h2 class="anchor anchorWithStickyNavbar_SLHE" id="how-is-a-lockfile-created">How is a lockfile created?<a class="hash-link" href="#how-is-a-lockfile-created" title="Direct link to heading">​</a></h2><div class="markdown-table-nowrap-col-1-and-2"><table><thead><tr><th>PNPM command</th><th>Rush command</th><th>What it does</th></tr></thead><tbody><tr><td><code>pnpm update</code></td><td><code>rush update --full</code></td><td>Rebuilds <code>pnpm-lock.yaml</code> file from scratch, choosing the latest versions that satisfy each version range specified in <strong>package.json</strong> files.</td></tr><tr><td><code>pnpm install</code><br>with <code>--no-frozen-lockfile</code></td><td><code>rush update</code></td><td>Checks whether the existing lockfile is consistent with your version ranges. If not, a minimal update is performed, preserving as much as possible from the previous lockfile.</td></tr><tr><td><code>pnpm install</code><br>with <code>--frozen-lockfile</code></td><td><code>rush install</code></td><td>Checks whether the existing lockfile is consistent with your version ranges. If not, Rush fails with an error message telling you  to run <code>rush update</code>.</td></tr><tr><td><code>pnpm install</code></td><td></td><td>Uses a heuristic to detect whether the command seems to be running in a CI environment.  If yes, the behavior is like <code>rush install</code>. Otherwise, the behavior is like <code>rush update</code>.</td></tr></tbody></table></div><p>With Rush, the lockfile is stored in <code>common/config/rush/pnpm-lockfile.yaml</code>. During installation, it gets
copied to <code>common/temp/</code> where the workspace installation occurs.</p><p>If you&#x27;re using a PNPM workspace without Rush, then <code>pnpm-lockfile.yaml</code> is instead stored in your repository&#x27;s
root folder, next to your <code>pnpm-workspace.yaml</code> file.</p><blockquote><p><strong>Two different meanings of &quot;lockfile&quot;</strong></p><p>In classic computing, the word <a href="https://en.wikipedia.org/wiki/File_locking#Lock_files" target="_blank" rel="noopener noreferrer">&quot;lock file&quot;</a>
has always referred to a file that coordinates a multi-process concurrency mechanism such as a mutex.
The <code>@rushstack/node-core-library</code> <a href="https://api.rushstack.io/pages/node-core-library.lockfile/" target="_blank" rel="noopener noreferrer">LockFile class</a>
implements such a mechanism.</p><p>When NPM was first introduced, its serialized installation plan was called a &quot;shrinkwrap file&quot;,
<code>npm-shrinkwrap.json</code> and <code>shrinkwrap.yaml</code>, and Rush still uses this terminology in many places.
Yarn called its file <code>yarn.lock</code>, adopting a similar naming convention as Ruby&#x27;s <code>Gemfile.lock</code>,
which people had started calling &quot;lockfiles&quot;. For consistency, PNPM and NPM later switched to using
&quot;lockfile&quot; instead of &quot;shrinkwrap file&quot;.</p><p>When the context is unclear, our documentation will sometimes use the term <strong>package lockfile</strong>
to avoid any confusion with concurrency lockfiles.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_SLHE" id="overall-file-structure">Overall file structure<a class="hash-link" href="#overall-file-structure" title="Direct link to heading">​</a></h2><p>Let&#x27;s continue with the
<a href="https://github.com/microsoft/lockfile-explorer-demos/tree/demo/sample-1" target="_blank" rel="noopener noreferrer">demo/sample-1</a>
branch from the <a href="https://github.com/microsoft/lockfile-explorer-demos/" target="_blank" rel="noopener noreferrer">lockfile-explorer-demos</a>
demo repo, which we already saw in the <a href="/pages/concepts/tracing_resolution/">Tracing package resolution</a> section.</p><p>Recall that the <code>demo/sample-1</code> lockfile looks like this:</p><img loading="lazy" src="https://raw.githubusercontent.com/microsoft/lockfile-explorer-demos/demo/sample-1/common/images/lfx-demo-sample-1.svg" alt="dependency graph: demo/sample-1" class="img_IZrY"><p>Let&#x27;s examine the corresponding YAML file. Using <code>...</code> to fold the YAML subtrees, the top-level file structure
looks like this:</p><p><a href="https://github.com/microsoft/lockfile-explorer-demos/blob/demo/sample-1/common/config/rush/pnpm-lock.yaml" target="_blank" rel="noopener noreferrer">lockfile-explorer-demos/common/config/rush/pnpm-lock.yaml</a> (<code>demo/sample-1</code> branch)</p><div class="language-yaml codeBlockContainer_rOsD theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RK14"><pre tabindex="0" class="prism-code language-yaml codeBlock_O81Q thin-scrollbar"><code class="codeBlockLines_oxQH"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">lockfileVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5.4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">importers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">.</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">../../projects/a</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">../../projects/b</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">../../projects/c</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">../../projects/d</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">../../projects/e</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">packages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">/@rushstack/j/1.0.0_@rushstack+n@2.0.0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">/@rushstack/k/1.0.0_@rushstack+m@1.0.0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">/@rushstack/k/1.0.0_wxpgugna4ivthu7yyu4fmciltu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">/@rushstack/l/1.0.0_@rushstack+m@1.0.0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">/@rushstack/l/1.0.0_wxpgugna4ivthu7yyu4fmciltu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">/@rushstack/m/1.0.0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">/@rushstack/n/2.0.0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">/@rushstack/n/3.0.0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup_U8U_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_ZlfJ" aria-hidden="true"><svg class="copyButtonIcon_Yhmw" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_vhcl" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Comparing with the diagram, the <code>importers</code> section represents our local projects in the workspace.
The <code>packages</code> section represents the external NPM packages downloaded from the NPM registry.</p><p>The YAML key for local projects is their file path, relative to the folder of <code>common/temp/pnpm-workspace.yaml</code>,
which Rush generates from its project inventory in <strong>rush.json</strong>. The empty <code>.:</code> key corresponds to the
root <code>common/temp/package.json</code> which is generated by Rush.</p><p>The YAML key for external packages appears to be a combination of the package name and version. For
example, <code>@rushstack/n</code> version <code>3.0.0</code> becomes <code>/@rushstack/n/3.0.0</code>.</p><p>But what are these strange entries with <code>_</code> suffixes? The answer is that they are <strong>peer doppelgangers</strong>
-- multiple installs of the same version of the same package. Although the
<a href="/pages/concepts/install_models/">PNPM installation model</a> eliminates NPM doppelgangers, it still needs to create
doppelgangers in the case of a peer dependency. For example, in the diagram we can see that <code>@rushstack/k</code>
version <code>1.0.0</code> needs to be installed in two separate folder locations:</p><ul><li><p><code>/@rushstack/k/1.0.0_@rushstack+m@1.0.0</code> provides <code>K@1</code> with peer <code>M@1</code>, installed into:<br>
<code>.pnpm/@rushstack+k@1.0.0_@rushstack+m@1.0.0/node_modules/@rushstack/k</code></p></li><li><p><code>/@rushstack/k/1.0.0_wxpgugna4ivthu7yyu4fmciltu</code> provides <code>K@1</code> with both peer <code>M@1</code> and <code>N@2</code>, installed into:<br>
<code>.pnpm/@rushstack+k@1.0.0_wxpgugna4ivthu7yyu4fmciltu/node_modules/@rushstack/k&gt;</code></p></li></ul><p>The <code>.pnpm</code> disk folder can be found under <code>common/temp/node_modules/</code>, and PNPM&#x27;s various symlinks will ultimately
point into paths under this folder. The exact disk paths are implementation details and therefore not captured in
the lockfile; to observe them, you need to run <code>rush install</code> and then inspect the resulting <code>common/temp</code> folder.</p><p>The <code>_@rushstack+m@1.0.0</code> suffix is really just an informational label to improve readability for humans.
In cases where the generated label would be too long, PNPM falls back to using a hashed string such
as <code>_wxpgugna4ivthu7yyu4fmciltu</code>.</p><h2 class="anchor anchorWithStickyNavbar_SLHE" id="lockfile-entries">Lockfile &quot;entries&quot;<a class="hash-link" href="#lockfile-entries" title="Direct link to heading">​</a></h2><p>Lockfile Explorer refers to the <code>importers:</code> and <code>packages:</code> items as <strong>lockfile entries</strong>. It&#x27;s important
to understand that &quot;entries&quot; don&#x27;t correspond to package versions, but rather <strong><em>folders on disk</em></strong> where
a package version got installed: A single package version may produce multiple lockfile entries,
in the case of doppelgangers.</p><p>The Lockfile Explorer UI displays <code>importers:</code> on the &quot;Projects&quot; tab. The <code>packages:</code> are displayed the &quot;Packages&quot; tab.</p><p>👉 Now&#x27;s a good time to run <code>lockfile-explorer</code> in your <code>demo/sample-1</code> checkout workspace, to see how
these lockfile entries appear in the UI.</p><h2 class="anchor anchorWithStickyNavbar_SLHE" id="a-package-entry">A package entry<a class="hash-link" href="#a-package-entry" title="Direct link to heading">​</a></h2><p>Here&#x27;s an example entry from the <code>packages:</code> section, describing an install of <code>@rushstack/l</code> version <code>1.0.0</code>:</p><div class="language-yaml codeBlockContainer_rOsD theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RK14"><pre tabindex="0" class="prism-code language-yaml codeBlock_O81Q thin-scrollbar"><code class="codeBlockLines_oxQH"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">/@rushstack/l/1.0.0_wxpgugna4ivthu7yyu4fmciltu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resolution</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">integrity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sha512</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">j9Pr82osu3t22rasnYg2pp/wMjMtg7KXu3WY59onaxHht/E8TgKqTWj4Mas2q+dF2xxs/vho9PdYKRlaXDzkhA==</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">peerDependencies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&#x27;@rushstack/m&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ^1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&#x27;@rushstack/n&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ^2.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">peerDependenciesMeta</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&#x27;@rushstack/n&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">optional</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">dependencies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&#x27;@rushstack/m&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&#x27;@rushstack/n&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 2.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">dev</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><br></span></code></pre><div class="buttonGroup_U8U_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_ZlfJ" aria-hidden="true"><svg class="copyButtonIcon_Yhmw" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_vhcl" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can see several fields:</p><ul><li><code>resolution:</code> has a tarball hash, used in the case where an NPM registry allowed a package to be republished with
different content (a deprecated practice)</li><li><code>dependencies:</code> lists the <code>dependencies</code> of this package, and the exact lockfile entry that was chosen
to match their version range.</li><li>The <code>dependencies:</code> field actually combines both regular and <code>devDependencies</code>, because the installation
plan doesn&#x27;t care /why/ something is a dependency; it ultimately needs to be installed or not</li><li><code>dev:</code> will be <code>true</code> if this package was only ever referenced via <code>devDependencies</code>. It is used by
PNPM&#x27;s <a href="https://pnpm.io/cli/install#--dev--d" target="_blank" rel="noopener noreferrer">--dev parameter</a>.</li><li><code>peerDependencies:</code> tracks the peer dependencies specially, since managing them is one of the most complex
aspects of the PNPM algorithm.</li><li><code>peerDependenciesMeta:</code> tracks whether they are optional or not</li></ul><h2 class="anchor anchorWithStickyNavbar_SLHE" id="a-project-entry">A project entry<a class="hash-link" href="#a-project-entry" title="Direct link to heading">​</a></h2><p>Perhaps surprisingly, the <code>importers:</code> section for local projects has a somewhat different structure,
even though both are described by the same <strong>package.json</strong> input format. Let&#x27;s see if we can explain why:</p><div class="language-yaml codeBlockContainer_rOsD theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_RK14"><pre tabindex="0" class="prism-code language-yaml codeBlock_O81Q thin-scrollbar"><code class="codeBlockLines_oxQH"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">../../projects/c</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">specifiers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&#x27;@rushstack/e&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&#x27;@rushstack/k&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ^1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&#x27;@rushstack/m&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ~1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">dependencies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&#x27;@rushstack/e&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> link</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">../e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&#x27;@rushstack/k&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1.0.0_@rushstack+m@1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&#x27;@rushstack/m&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1.0.0</span><br></span></code></pre><div class="buttonGroup_U8U_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_ZlfJ" aria-hidden="true"><svg class="copyButtonIcon_Yhmw" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_vhcl" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p><code>specifiers:</code> remembers the original SemVer ranges from <strong>package.json</strong>. Because this package was not
published to an NPM registry, its <strong>package.json</strong> file can be manually modified at any time, so the
lockfile needs to detect such changes. In other words, the lockfile needs to capture more details about
local projects, because they are mutable whereas published packages are (mostly) immutable.</p></li><li><p><code>dependencies:</code> tracks the dependencies in the same way as the <code>packages:</code> section.
The <code>link:../e</code> string describes a dependency that will be symlinked to a local project folder,
for example due to a <code>workspace:*</code> specifier in <strong>package.json</strong>.</p></li><li><p>Note that <code>peerDependencies</code> never appears in this section. The reason is that PNPM does not properly
install peer dependencies for local projects. Why? Well, as we&#x27;ve seen, peer dependencies are installed
by creating peer doppelganger folders -- multiple copies of the package folder. But for a local project
that is built from source code, how would that work? Whenever you recompile the code, there would need
to be some mechanism that copies the output into the various doppelganger folders under <code>node_modules</code>.
In practice it doesn&#x27;t cause much trouble, but nonetheless it&#x27;s a somewhat important limitation to understand,
as it explains some weirdness with peer dependencies for local projects.
See <a href="https://github.com/pnpm/pnpm/issues/4407#issuecomment-1125470213" target="_blank" rel="noopener noreferrer">PNPM#4407</a>
for our current thinking about it.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_SLHE" id="lockfile-entry-identifiers">Lockfile entry identifiers<a class="hash-link" href="#lockfile-entry-identifiers" title="Direct link to heading">​</a></h2><p>Looking at the above snippets, you may notice that the <code>dependencies:</code> section uses a different
entry identifier syntax than the YAML keys. For example:</p><ul><li><code>../../projects/e</code> from <code>importers:</code> gets referenced as <code>../e</code>. The path is relative to <code>projects/c</code> instead
of relative to <code>common/temp/pnpm-workspace.yaml</code>.</li><li><code>/@rushstack/k/1.0.0_@rushstack+m@1.0.0</code> from <code>packages:</code> gets referenced as
<code>&#x27;@rushstack/k&#x27;: 1.0.0_@rushstack+m@1.0.0</code>.</li></ul><p>The <code>dependencies:</code> uses a shortened form of the lockfile entry identifier, probably because it yields
significant file compression for the YAML file, and maybe is a little easier to read. However this inconsistency
makes it somewhat difficult to traverse the dependency graph by searching for strings in your text editor.
This was one of the major motivations for creating the Lockfile Explorer app.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/microsoft/rushstack-websites/tree/main/websites/lfx.rushstack.io/docs/pages/concepts/pnpm_lockfile.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_BLyC" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_w8CT"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/pages/concepts/tracing_resolution/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Tracing package resolution</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/pages/concepts/strict_settings/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Strict settings</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_PJGn thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#why-do-we-need-a-lockfile" class="table-of-contents__link toc-highlight">Why do we need a lockfile?</a></li><li><a href="#what-does-a-lockfile-store" class="table-of-contents__link toc-highlight">What does a lockfile store?</a></li><li><a href="#how-is-a-lockfile-created" class="table-of-contents__link toc-highlight">How is a lockfile created?</a></li><li><a href="#overall-file-structure" class="table-of-contents__link toc-highlight">Overall file structure</a></li><li><a href="#lockfile-entries" class="table-of-contents__link toc-highlight">Lockfile &quot;entries&quot;</a></li><li><a href="#a-package-entry" class="table-of-contents__link toc-highlight">A package entry</a></li><li><a href="#a-project-entry" class="table-of-contents__link toc-highlight">A project entry</a></li><li><a href="#lockfile-entry-identifiers" class="table-of-contents__link toc-highlight">Lockfile entry identifiers</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">© 2023 Microsoft</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ae9b29fa.js"></script>
<script src="/assets/js/main.78db02df.js"></script>
</body>
</html>